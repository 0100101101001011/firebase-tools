#!/usr/bin/env node

var optimist = require('optimist'),
    argv = optimist.usage('Usage: firebase').argv,
    prompt = require('prompt'),
    Auth = require('../lib/auth'),
    App = require('../lib/app'),
    Firebase = require('../lib/firebase');

prompt.override = argv;
prompt.message = '';
prompt.delimiter = '';

if (argv._.length === 0) {

  // Require at least one non-hyphenated option
  optimist.showHelp();

} else {
  // Top-level router
  switch (argv._[0]) {
    case 'refreshtoken':
      Auth.login(function(err, email, token) {
        if (err) {
          console.log("Sorry, we couldn't refresh the token");
        } else {
          console.log('New token saved for ' + email + ': ' + token);
        }
      });
      break;
    case 'app':
      new App();
      break;
    case 'list':
      Firebase.list();
      break;
    case 'create':
      Firebase.create();
      break;
    default:
      // No route found
      optimist.showHelp();
  }
}
