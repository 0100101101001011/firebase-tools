#!/usr/bin/env node

var optimist = require('optimist'),
    argv = optimist
              .alias('f', 'firebase')
              .alias('h', 'help')
              .alias('p', 'public')
              .alias('r', 'rules')
              .alias('t', 'template')
              .alias('v', 'version')
              .argv,
    prompt = require('prompt'),
    firebase = require('../lib/firebase'),
    app = require('../lib/app');

prompt.override = argv;
prompt.message = '';
prompt.delimiter = '';
prompt.colors = false;

if (argv._.length === 0) {

  if (argv.version) {
    firebase.showVersion();
  } else {
    firebase.showHelp();
  }

} else {
  // Top-level router
  switch (argv._[0]) {

    // Top-level functionality

    case 'login':
      firebase.login();
      break;
    case 'logout':
      firebase.logout();
      break;
    case 'ls':
    case 'list':
      firebase.list();
      break;

    // Submodules

    case 'init':
    case 'initialise':
    case 'initialize':
      app.init(argv);
      break;
    case 'bootstrap':
      app.bootstrap(argv);
      break;
    case 'deploy':
      app.deploy(argv);
      break;

    case 'h':
    case 'hel':
    case 'hep':
    case 'hepl':
    case 'help':
      firebase.showHelp();
      break;

    default:
      firebase.showCommandError();
  }
}
